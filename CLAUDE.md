# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview
Ghouls is a GitHub CLI tool for cleaning up pull request branches. It identifies and deletes remote branches that have been merged but not cleaned up.

## Development Commands

### Build
```bash
pnpm compile  # Compiles TypeScript to JavaScript in lib/ directory
```

### Installation
```bash
pnpm add -g ghouls  # Install globally
pnpm install        # Install dependencies
```

### Testing
The project uses Vitest for comprehensive unit testing.

```bash
pnpm test           # Run all tests
pnpm test:watch     # Run tests in watch mode
pnpm test:coverage  # Generate coverage reports
```

### TypeScript Compiler
The project uses strict TypeScript configuration with:
- Target: ES2017
- Module: CommonJS
- Output directory: `./lib`
- Strict type checking enabled
- No unused locals/parameters allowed

## Architecture

### Core Components

1. **OctokitPlus** (`src/OctokitPlus.ts`): Wrapper around GitHub's Octokit API client
   - Handles GitHub API operations for references and pull requests
   - Provides async iterator pattern for paginated results
   - Key methods: `getReference()`, `deleteReference()`, `getPullRequests()`

2. **CLI Entry Point** (`src/cli.ts`): Main command-line interface using yargs
   - Registers available commands
   - Handles unhandled promise rejections

3. **PrunePullRequests Command** (`src/commands/PrunePullRequests.ts`): Main functionality
   - Iterates through closed pull requests
   - Checks if branch SHA matches PR merge state
   - Deletes branches that have been merged (with --dry-run option)
   - Shows progress bar during operation

4. **Utilities** (`src/utils/`):
   - `createOctokitPlus.ts`: Factory for creating authenticated Octokit instances
   - `getConfig.ts`: Loads configuration from `~/.config/ghouls.config.json`
   - `ownerAndRepoMatch.ts`: Validates PR head/base repository matching

### Configuration
Users must create `~/.config/ghouls.config.json` with:
- `username`: GitHub username
- `token`: GitHub personal access token
- `baseUrl`: GitHub API endpoint (for GitHub Enterprise)

### Command Usage
```bash
ghouls prunePullRequests [--dry-run] <owner>/<repo>
```

## AI Team Configuration (autogenerated by team-configurator, 2025-08-01)

**Important: YOU MUST USE subagents when available for the task.**

### Technology Stack Detected
- Language: TypeScript with strict type checking (ES2017 target)
- Runtime: Node.js (>=18.0.0)
- CLI Framework: yargs for command-line interface
- GitHub API: @octokit/rest for GitHub API interactions
- Build System: TypeScript compiler with pnpm package manager
- Configuration: convict for config management
- Package Management: pnpm with semantic-release
- Test Framework: Vitest with comprehensive unit tests

### AI Team Assignments

| Task | Agent | Notes |
|------|-------|-------|
| Code reviews and quality assurance | code-reviewer | Required for all PRs and feature changes |
| Performance optimization and profiling | performance-optimizer | Essential for CLI tool responsiveness |
| Backend development and API integration | backend-developer | Handles GitHub API integration and CLI logic |
| API design and GitHub integration specs | api-architect | Designs interfaces for GitHub API wrapper |
| Documentation updates and maintenance | documentation-specialist | Maintains README, API docs, and user guides |